node('master') {
    stage('Checkout') {
        checkout scm
        sh 'ls -sh'
    }
    
    stage('Build Docker image') {
        sh 'df -h'
        sh 'docker build --tag="offlogs-production-web" --file="devops/publish/Dockerfile" .'
    }
    
    stage('Save Docker image') {
        sh 'docker save -o image.tar offlogs-production-web'
    }
    
    stage('Publish stash') {
        stash name: 'target', includes: "**/*.tar"
    }
}
node('production') {
    stage('Unstash') {
        unstash 'target'
        sh 'ls -sh'
        sh 'docker load --input image.tar'
        sh 'docker image ls'
    }

    stage('Run') {
        
    }
}
