version: "3.8"

services:
  api:
    container_name: offlogs-api-production
    restart: always
    build:
      context: ./../../
      dockerfile: devops/prod/Api/Dockerfile
      args:
        BUILD_COMMAND: build
    environment:
      - ConnectionStrings__DefaultConnection=${CONNECTION_STRING}
      - App__Auth__SymmetricSecurityKey=${JWT_USER_KEY}
      - App__Application__SymmetricSecurityKey=${JWT_APPLICATION_KEY}
      - Kafka_Servers=${KAFKA_SERVERS}
      - Kafka_ProducerId=${KAFKA_PRODUCER_ID}
      - Kafka_Topic_Logs=${KAFKA_TOPIC_LOGS}
      - Kafka_Topic_Notification=${KAFKA_TOPIC_NOTIFICATION}
      - Kafka_ConsumerClientId=${KAFKA_CONSUMER_CLIENT_ID}
    ports:
      - 5051:80
  api-frontend:
    container_name: offlogs-api-frontend-production
    restart: always
    build:
      context: ./../../
      dockerfile: devops/prod/Api.Frontend/Dockerfile
      args:
        BUILD_COMMAND: build
    environment:
      - ConnectionStrings__DefaultConnection=${CONNECTION_STRING}
      - App__Auth__SymmetricSecurityKey=${JWT_USER_KEY}
      - App__Application__SymmetricSecurityKey=${JWT_APPLICATION_KEY}
      - Kafka_Servers=${KAFKA_SERVERS}
      - Kafka_ProducerId=${KAFKA_PRODUCER_ID}
      - Kafka_Topic_Logs=${KAFKA_TOPIC_LOGS}
      - Kafka_Topic_Notification=${KAFKA_TOPIC_NOTIFICATION}
      - Kafka_ConsumerClientId=${KAFKA_CONSUMER_CLIENT_ID}
    ports:
      - 6033:80
    depends_on:
      - api
  worker:
    container_name: offlogs-worker-production
    restart: always
    build:
      context: ./../../
      dockerfile: devops/prod/Worker/Dockerfile
      args:
        BUILD_COMMAND: build
    environment:
      - ConnectionStrings__DefaultConnection=${CONNECTION_STRING}
      - App__Auth__SymmetricSecurityKey=${JWT_USER_KEY}
      - App__Application__SymmetricSecurityKey=${JWT_APPLICATION_KEY}
      - Kafka_Servers=${KAFKA_SERVERS}
      - Kafka_ProducerId=${KAFKA_PRODUCER_ID}
      - Kafka_Topic_Logs=${KAFKA_TOPIC_LOGS}
      - Kafka_Topic_Notification=${KAFKA_TOPIC_NOTIFICATION}
      - Kafka_ConsumerClientId=${KAFKA_CONSUMER_CLIENT_ID}
    depends_on:
      - api
  web:
    container_name: offlogs-web-production
    restart: always
    build:
      context: ./../../
      dockerfile: devops/prod/Web/Dockerfile
      args:
        BUILD_COMMAND: build
    ports:
      - 6018:80
    depends_on:
      - api