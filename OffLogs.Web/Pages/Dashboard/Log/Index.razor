@page "/dashboard/logs"
@using OffLogs.Web.Services.Http
@using OffLogs.Business.Common.Models.Api.Request.Board
@using OffLogs.Business.Common.Models.Api.Response.Board
@using OffLogs.Web.Shared.Ui.Form.CustomDropDown
@inject IApiService _apiService

<h1>Logs</h1>

<CustomDropDown 
    Items="@_listItems" 
    @ref="_selectApplications" 
    OnChanged="OnSelectedApplication"
    NonSelectedLabel="Select your application"
/>

<table class="table table-hover w-table">
    <thead>
        <tr>
           <th>Name</th> 
        </tr>
    </thead>
    <tbody>
    @foreach (var log in _logs)
    {
        <tr>
            <td @onclick="OnClickRowAsync">@log.Message</td>
        </tr>    
    }
    </tbody>
</table>

@code
{
    private List<LogResponseModel> _logs = new();
    private int _currentPage = 1;
    private int _selectedApplicationId = 1;

    private CustomDropDown _selectApplications { get; set; }
    
    private List<DropDownListItem> _listItems = new()
    {
        new ()
        {
            Id = "1",
            Label = "111",
            Description = "11111"
        },
        new ()
        {
            Id = "2",
            Label = "222",
            Description = "222"
        },
        new ()
        {
            Id = "3",
            Label = "3333",
            Description = "3333"
        },
        new ()
        {
            Id = "4",
            Label = "4444",
            Description = "44444"
        }
    };
    
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        await LoadListAsync(false);
    }

    private async Task LoadListAsync(bool isLoadNextPage = true)
    {
        if (isLoadNextPage)
        {
            _currentPage++;
        }
        var response = await _apiService.GetLogs(new LogListRequestModel()
        {
            ApplicationId = _selectedApplicationId,
            Page = _currentPage
        });
        _logs = response.Items.ToList();
        StateHasChanged();
    }

    private async Task OnClickRowAsync()
    {
        Console.WriteLine("asdads");
    }

    private void OnSelectedApplication(DropDownListItem selectListItem)
    {
        Console.WriteLine(selectListItem?.Id);
    }
}
